C51 COMPILER V9.59.0.0   TOUCH                                                             02/21/2023 10:54:43 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE TOUCH
OBJECT MODULE PLACED IN .\Objects\touch.obj
COMPILER INVOKED BY: C:\Keil_C51\C51\BIN\C51.EXE src\touch.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\src;.\Driver\inc;.\Driver
                    -\src) DEBUG OBJECTEXTEND PRINT(.\Listings\touch.lst) TABS(2) OBJECT(.\Objects\touch.obj)

line level    source

   1          #include  "touch.h"
   2          #include  "infrared.h"
   3          #include  "global.h"
   4          #include  "STC8xxxx.h"  
   5          #include  "stc8g1k_code.h"
   6          #include  "uart.h"
   7          
   8          #define   TOUCH_PIN      P36
   9          sfr INTCLKO = 0x8f;
  10          
  11          u16 Touch_time;      //触摸计时器
  12          bit Touch_flag=0;    //触摸IC输出标志
  13          bit touch_preFlag=0; //上次触摸IC输出标志
  14          
  15          static  u8 touch_check(void);    //触摸检测
  16          static void touch_deal(void);    //触摸处理
  17          
  18          void  touch_init(void)
  19          {
  20   1          Touch_time = 0;
  21   1          Touch_flag = 0;  
  22   1          touch_preFlag = 0;
  23   1      }
  24          
  25          void  touch_check_deal(void)
  26          {
  27   1          touch_check();
  28   1          touch_deal();
  29   1      }
  30          /*************触摸功能*********************/
  31          static  u8 touch_check(void)
  32          {   //触摸输出检测   无触摸时高电平，有触摸时低电平时长大于200ms
  33   1          if(TOUCH_PIN == 0)
  34   1          {
  35   2               if(Touch_flag)          
  36   2                 Touch_time = 0;
  37   2               else if(Touch_time > 500)  //139微秒 *500 = 69.5ms
  38   2               {
  39   3                    Touch_time = 0;
  40   3                    Touch_flag = 1;     
  41   3                    return 1;
  42   3               }
  43   2                     
  44   2          }
  45   1          else 
  46   1          {
  47   2              if(Touch_flag)
  48   2              {
  49   3                  if(Touch_time > 2000)  //139微秒 *2000 = 279.5ms
  50   3                  {
  51   4                     Touch_time=0;
  52   4                     Touch_flag = 0;
  53   4                  }
  54   3              }
C51 COMPILER V9.59.0.0   TOUCH                                                             02/21/2023 10:54:43 PAGE 2   

  55   2              else 
  56   2              {
  57   3                  Touch_time=0;
  58   3                
  59   3              } 
  60   2          }
  61   1          return 0;
  62   1      }
  63          
  64          static void touch_deal(void)
  65          {
  66   1         if(Touch_flag)
  67   1         {
  68   2            if(!touch_preFlag)
  69   2            {
  70   3                touch_preFlag = 1;
  71   3                btn_value++;
  72   3                sysFunFlag = 1;
  73   3              
  74   3                if(btn_value > BUTTON_VALUE_MAX)
  75   3                {
  76   4                    btn_value = 0;  
  77   4                    sysFunFlag = 0;    
  78   4                }           
  79   3                rdelay_acton_fun(btn_value);  
  80   3            }
  81   2         }
  82   1         else 
  83   1         {
  84   2            touch_preFlag = 0;  
  85   2         }
  86   1      }
  87          //-------------------------外部中断3触摸按键初始化-------------------------
  88          static void Int2_init(void)
  89          {
  90   1        EX0 = 1;  //使能INT0中断
  91   1        INTCLKO = EX2; //使能 INT2 下降沿中断
  92   1        //INTCLKO |= EX3; //使能 INT3 下降沿中断//触发方式为下降沿触发
  93   1        //INTCLKO |= EX4; //使能 INT4 下降沿中断
  94   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    118    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
