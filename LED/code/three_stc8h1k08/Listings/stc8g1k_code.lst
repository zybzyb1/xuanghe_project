C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/15/2023 11:00:29 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE STC8G1K_CODE
OBJECT MODULE PLACED IN .\Objects\stc8g1k_code.obj
COMPILER INVOKED BY: C:\Keil_C51\C51\BIN\C51.EXE src\stc8g1k_code.c OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\src;.\Driver\
                    -inc;.\Driver\src) DEBUG PRINT(.\Listings\stc8g1k_code.lst) TABS(2) OBJECT(.\Objects\stc8g1k_code.obj)

line level    source

   1          /*******************åŠŸèƒ½æè¿°*******************
   2          è§¦æ‘¸åŠŸèƒ½
   3          
   4          1ã€ç¬¬ä¸€æ¬¡è§¦æ‘¸ç»§ç”µå™¨1 (PCBæ¿æœ€è¾¹ä¸Šè¿™ä¸ªç»§ç”µå™¨)æ¥é€š220Vç”µæºã€‚
   5          
   6          2ã€ç¬¬äºŒæ¬¡è§¦æ‘¸ç»§ç”µå™¨1 (PCBæ¿æœ€è¾¹ä¸Šè¿™ä¸ªç»§ç”µå™¨)æ–­å¼€ï¼Œç»§ç”µå™¨2 (PCBæ¿ä¸­é—´ç»§ç”µå™¨)æ
             -¥é€š220Vç”µæºã€‚
   7          
   8          3ã€ç¬¬ä¸‰æ¬¡è§¦æ‘¸ç»§ç”µå™¨1 ã€æ‘¸ç»§ç”µå™¨2 éƒ½æ¥é€š220Vç”µæºã€‚
   9          
  10          4ã€ç¬¬å››æ¬¡è§¦æ‘¸åˆå›åˆ°ç¬¬ä¸€æ¬¡è§¦æ‘¸å®ç°çš„åŠŸèƒ½ï¼Œåªæœ‰(PCBæ¿æœ€è¾¹ä¸Šè¿™ä¸ªç»§ç”µå™¨)æ¥é€š2
             -20Vç”µæºã€‚
  11          ************************************************/
  12          
  13          #include  "stc8g1k_code.h"    
  14          #include  "STC8xxxx.h"  
  15          #include  "STC8G_H_GPIO.h"
  16          #include  "STC8G_H_ADC.h"
  17          #include  "STC8G_H_NVIC.h"
  18          #include  "string.h"
  19          #include  "global.h"
  20          #include  "led2_digital_tube.h"
  21          #include  "uart.h"
  22          #include  "infrared.h"
  23          #include  "touch.h"
  24          #include  "temperature.h"
  25          #include  "buzzer.h"
  26          
  27          #ifdef    UART_ENABLE
              #include  "uart.h"
              #endif
  30          
  31          #define ET2 0x04
  32           
  33          //æ•°æ®å®šä¹‰
  34          u8 si_level;        //å¯æ§ç¡…æ§åˆ¶çº§æ•° 0å…³é—­ æœ€å¤§3æ¡£
  35          
  36          //å‡½æ•°å£°æ˜
  37          static void Timer0Init(void);   //å®šæ—¶è®¡æ•°å™¨0åˆå§‹åŒ–å‡½æ•°
  38          static void Timer1Init(void);   //å®šæ—¶è®¡æ•°å™¨1åˆå§‹åŒ–å‡½æ•°
  39          static void Timer2Init(void);   //10æ¯«ç§’@6.000MHz
  40          static void gpio_config(void);
  41          static void Int1_init(void);
  42          static void Int0_init(void);
  43          void rdelay_acton_fun(u8 action_value);
  44          void delay(u16 count);    //å»¶æ—¶å‡½æ•°å£°æ˜
  45          
  46          //-------------------------ä¸»å‡½æ•°----------------------------
  47          void main(void)
  48          {
  49   1        gpio_config();
  50   1      
  51   1        Timer0Init();   //å®šæ—¶è®¡æ•°å™¨0åˆå§‹åŒ–å‡½æ•°
  52   1        Timer1Init();   //å®šæ—¶è®¡æ•°å™¨1åˆå§‹åŒ–å‡½æ•°
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/15/2023 11:00:29 PAGE 2   

  53   1        Timer2Init();   //10æ¯«ç§’@6.000MHz
  54   1        //è¿‡é›¶æ£€æµ‹
  55   1        Int0_init();    //å¤–éƒ¨ä¸­æ–­0åˆå§‹åŒ–å‡½æ•°  è¿‡é›¶æ£€æµ‹è„š
  56   1        //Int3_init();    //å¤–éƒ¨ä¸­æ–­3åˆå§‹åŒ–å‡½æ•°  
  57   1        infrared_init(); //çº¢å¤–åˆå§‹åŒ–å‡½æ•°
  58   1        touch_init();    //è§¦æ‘¸åˆå§‹åŒ–å‡½æ•°
  59   1        buzzer_init();
  60   1        
  61   1        #ifdef UART_ENABLE
                UartInit();
                #endif
  64   1        EA = 1;         //å¼€ä¸­æ–­
  65   1        delay(500);     //ç­‰å¾…é…ç½®ç¨³å®š
  66   1        #ifdef UART_ENABLE
                PrintString1("STC8:\r\n");    //UART1å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²
                #endif
  69   1        
  70   1        WDT_CONTR = 0x23; //ä½¿èƒ½çœ‹é—¨ç‹—,æº¢å‡ºæ—¶é—´çº¦ä¸º 0.5s
  71   1        //WDT_CONTR = 0x24; //ä½¿èƒ½çœ‹é—¨ç‹—,æº¢å‡ºæ—¶é—´çº¦ä¸º 1s
  72   1        // WDT_CONTR = 0x27; //ä½¿èƒ½çœ‹é—¨ç‹—,æº¢å‡ºæ—¶é—´çº¦ä¸º 8s
  73   1      
  74   1        temperature_init();
  75   1        
  76   1        rdelay_acton_fun(0);
  77   1        si_level =0;
  78   1        led_display_enable=0;
  79   1        buzzerEnableFlag =1;
  80   1      
  81   1        while(1)
  82   1        {   
  83   2           WDT_CONTR |= 0x10; //æ¸…çœ‹é—¨ç‹—,å¦åˆ™ç³»ç»Ÿå¤ä½
  84   2           temperature_get_deal();    
  85   2           if(overtemperature_check())
  86   2              continue;
  87   2           infrared_check_deal(); 
  88   2           touch_check_deal();//è§¦æ‘¸æ£€æµ‹
  89   2           buzzer_run();
  90   2          
  91   2        }
  92   1      }
  93          
  94          
  95          static void gpio_config(void)
  96          {
  97   1        
  98   1         //æ•°ç ç®¡å¼•è„šåˆå§‹åŒ–
  99   1         P3_MODE_OUT_PP(GPIO_Pin_5 | GPIO_Pin_7 |GPIO_Pin_4);   //æ¨æŒ½è¾“å‡ºA F G       
 100   1         P1_MODE_OUT_PP(GPIO_Pin_6 | GPIO_Pin_4 | GPIO_Pin_2 |GPIO_Pin_3);//æ¨æŒ½è¾“å‡ºB C D E  
 101   1         P1_MODE_OUT_PP(GPIO_Pin_0);   //æ¨æŒ½è¾“å‡ºDIG2  
 102   1         P5_MODE_OUT_PP(GPIO_Pin_4);   //æ¨æŒ½è¾“å‡ºDIG1 
 103   1         P54 = 0; P16=0;  //æ•°ç ç®¡ä¸æ˜¾ç¤º
 104   1      // ||GPIO_Pin_7
 105   1         //P5_MODE_OUT_PP(GPIO_Pin_5);   //æ¨æŒ½è¾“å‡ºAH
 106   1         //P55 = 1;
 107   1        
 108   1         //è§¦æ‘¸ICå¼•è„šåˆå§‹åŒ– 
 109   1         P3_ST_ENABLE(GPIO_Pin_3);     //æ–½å¯†ç‰¹è§¦å‘ä½¿èƒ½
 110   1         P3_MODE_IN_HIZ(GPIO_Pin_3);   //é«˜é˜»è¾“å…¥ 
 111   1         //Int2_init();  //P3.6/INT2ä¸‹é™æ²¿ä¸­æ–­
 112   1      
 113   1         //å¯æ§ç¡…æ§åˆ¶IOåˆå§‹åŒ–
 114   1         P1_MODE_OUT_PP(GPIO_Pin_7);   //æ¨æŒ½è¾“å‡º 
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/15/2023 11:00:29 PAGE 3   

 115   1         SI_OFF();   //å…³æ–­å¯æ§ç¡…
 116   1         
 117   1         //èœ‚é¸£å™¨IOåˆå§‹åŒ–
 118   1         P1_MODE_OUT_PP(GPIO_Pin_1);   //æ¨æŒ½è¾“å‡º 
 119   1         P11=1;
 120   1        
 121   1      /*
 122   1          #if   0
 123   1        //STC8Gç³»åˆ—å•ç‰‡æœºé™¤P3.0å’ŒP3.1å¤–ï¼Œæ‰€æœ‰I/Oä¸Šç”µå‡ä¸ºé«˜é˜»è¾“å…¥çŠ¶æ€ï¼Œéœ€å…ˆé…ç½®å†ä½¿ç”¨
 124   1        P3M0 |=0x08;    //P3.3å¼•è„šä¸ºæ¨æŒ½è¾“å‡ºæ¨¡å¼
 125   1        P3M1 &=0xF7;    //P3.3å¼•è„šä¸ºæ¨æŒ½è¾“å‡ºæ¨¡å¼
 126   1        RSTCFG &=0xEF;    //å¤ä½å¼•è„šP5.4å½“åšæ™®é€šI/Oå¼•è„š
 127   1        P5M0 |=0x10;    //P5.4å¼•è„šä¸ºæ¨æŒ½è¾“å‡ºæ¨¡å¼
 128   1        P5M1 &=0xEF;    //P5.4å¼•è„šä¸ºæ¨æŒ½è¾“å‡ºæ¨¡å¼
 129   1        P5M0 &=0xDF;    //P5.5å¼•è„šä¸ºå‡†åŒå‘å£æ¨¡å¼
 130   1        P5M1 &=0xDF;    //P5.5å¼•è„šä¸ºå‡†åŒå‘å£æ¨¡å¼
 131   1        #endif
 132   1          GPIO_InitTypeDef  GPIO_InitStructure;   //ç»“æ„å®šä¹‰
 133   1      
 134   1          GPIO_InitStructure.Pin  = GPIO_Pin_0 | GPIO_Pin_1;    //æŒ‡å®šè¦åˆå§‹åŒ–çš„IO, GPIO_Pin_0 ~ GPIO_Pin_7
 135   1          GPIO_InitStructure.Mode = GPIO_PullUp;  //æŒ‡å®šIOçš„è¾“å…¥æˆ–è¾“å‡ºæ–¹å¼,GPIO_PullUp,GPIO_HighZ,GPIO_OU
             -T_OD,GPIO_OUT_PP
 136   1          GPIO_Inilize(GPIO_P3,&GPIO_InitStructure);  //åˆå§‹åŒ–
 137   1        
 138   1         P3_PULL_UP_ENABLE(GPIO_Pin_0 | GPIO_Pin_1);//      
 139   1         //P3_PULL_UP_ENABLE(GPIO_Pin_1);//
 140   1        
 141   1         P1_MODE_OUT_PP(GPIO_Pin_0);   //æ¨æŒ½è¾“å‡ºP1.0 æ§åˆ¶ä¸­é—´ç¬¬äºŒä¸ªç»§ç”µå™¨
 142   1         P3_MODE_OUT_PP(GPIO_Pin_6 |GPIO_Pin_7);   //æ¨æŒ½è¾“å‡ºP3.7 æ§åˆ¶è¾¹ä¸Šç¬¬ä¸€ä¸ªç»§ç”µå™¨  //æ¨æŒ½è¾“
             -å‡ºP3.6 çº¢å¤–ç®¡è§¦æ‘¸IC å°æ¿ç”µæºæ§åˆ¶
 143   1        
 144   1         //P3_MODE_OUT_PP(GPIO_Pin_6);   //æ¨æŒ½è¾“å‡ºP3.6 çº¢å¤–ç®¡è§¦æ‘¸IC å°æ¿ç”µæºæ§åˆ¶
 145   1         P3_MODE_IN_HIZ(GPIO_Pin_3 | GPIO_Pin_4);   //æ–½å¯†ç‰¹è§¦å‘ä½¿èƒ½P3.3 è¿æ¥è§¦æ‘¸ICè¾“å‡ºè„š
 146   1         //P3_MODE_IN_HIZ(GPIO_Pin_4);   //æ–½å¯†ç‰¹è§¦å‘ä½¿èƒ½P3.4 è¿æ¥çº¢å¤–ç®¡æ¥æ”¶è„š
 147   1        
 148   1         DELAY1_OFF;   
 149   1         DELAY2_OFF; 
 150   1         P36 = 0; 
 151   1      */
 152   1      }
 153          //-------------------------å»¶æ—¶å‡½æ•°----------------------------
 154          void delay(u16 count)
 155          {
 156   1        while(count--)
 157   1        {
 158   2          _nop_();
 159   2        }
 160   1      }
 161          //å‡½æ•°åŠŸèƒ½ï¼šå¤‡ä»½ä¸è¿˜åŸå‚æ•°
 162          void display_para(u8 bak)
 163          {
 164   1         static u8 btn_value_bak=0xff;
 165   1         if(1 == bak)
 166   1            btn_value_bak = btn_value;
 167   1         else
 168   1         {
 169   2             btn_value = btn_value_bak;
 170   2             rdelay_acton_fun(btn_value);
 171   2         }
 172   1      
 173   1      }
 174          void rdelay_acton_fun(u8 action_value)
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/15/2023 11:00:29 PAGE 4   

 175          {
 176   1          switch(action_value)
 177   1          {
 178   2              case 0:  // æ–­å¼€æ‰€æœ‰ç»§ç”µå™¨
 179   2                led_display_enable=0;  //ä¸Šç”µLEDæ•°ç ç®¡ä¸æ˜¾ç¤º
 180   2                si_level = 0; 
 181   2              break;
 182   2              case 1:   //æ•°ç ç®¡æ˜¾ç¤º--
 183   2                  led_display_enable=1; 
 184   2                  digital_value[0]=0xff;
 185   2                  digital_value[1]=0xff;
 186   2                  buzzerEnableFlag = 1;
 187   2                  si_level = 0;
 188   2              break;
 189   2              case 2:  //æ•°ç ç®¡æ˜¾ç¤ºL1
 190   2                  led_display_enable=1; 
 191   2                  digital_value[0]=0x10;
 192   2                  digital_value[1]=0x01;
 193   2                  //buzzerEnableFlag = 1;
 194   2                  si_level = 1;
 195   2              break;
 196   2              case 3:
 197   2                  led_display_enable=1; 
 198   2                  digital_value[0]=0x10;
 199   2                  digital_value[1]=0x02;
 200   2                  //buzzer_enable = 1;
 201   2                  si_level = 2;
 202   2              break;
 203   2              case 4:
 204   2                  led_display_enable=1; 
 205   2                  digital_value[0]=0x10;
 206   2                  digital_value[1]=0x03;
 207   2                  //buzzer_enable = 1;
 208   2                  si_level = 3;
 209   2              break;
 210   2              case 5:
 211   2                  led_display_enable=1; 
 212   2                  digital_value[0]=0x0e;
 213   2                  digital_value[1]=0x01;
 214   2                  //buzzer_enable = 0;
 215   2                  si_level = 0;
 216   2              break;
 217   2              default:
 218   2                
 219   2              break;
 220   2          }
 221   1      }
 222          
 223          //-------------------------å®šæ—¶å™¨åˆå§‹åŒ–----------------------------
 224          static void Timer0Init(void)    //139å¾®ç§’@6.000MHz
 225          {
 226   1        AUXR &= 0x7F;   //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
 227   1        TMOD &= 0xF0;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 228   1        TMOD |= 0x02;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 229   1        TL0 = 0xBA;   //è®¾ç½®å®šæ—¶åˆå€¼
 230   1        TH0 = 0xBA;   //è®¾ç½®å®šæ—¶é‡è½½å€¼
 231   1        TF0 = 0;    //æ¸…é™¤TF0æ ‡å¿—
 232   1        TR0 = 1;    //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
 233   1        ET0 = 1;    //ä½¿èƒ½T0ä¸­æ–­
 234   1      }
 235          static void Timer1Init(void)    //125æ¯«ç§’@6.000MHz
 236          {
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/15/2023 11:00:29 PAGE 5   

 237   1        AUXR &= 0xBF;   //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
 238   1        TMOD &= 0x0F;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 239   1        TL1 = 0xDC;   //è®¾ç½®å®šæ—¶åˆå€¼
 240   1        TH1 = 0x0B;   //è®¾ç½®å®šæ—¶åˆå€¼
 241   1        TF1 = 0;    //æ¸…é™¤TF1æ ‡å¿—
 242   1        TR1 = 1;    //å®šæ—¶å™¨1å¼€å§‹è®¡æ—¶
 243   1        
 244   1        ET1 = 1;    //ä½¿èƒ½T1ä¸­æ–­
 245   1      }
 246          static void Timer2Init(void)    //10æ¯«ç§’@6.000MHz
 247          {
 248   1        AUXINTIF &= ~T2IF; //æ¸…ä¸­æ–­æ ‡å¿—
 249   1        AUXR &= 0xFB;   //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
 250   1        T2L = 0x78;   //è®¾ç½®å®šæ—¶åˆå€¼
 251   1        T2H = 0xEC;   //è®¾ç½®å®šæ—¶åˆå€¼
 252   1        AUXR &= ~0x10;//å®šæ—¶å™¨2ä¸è®¡æ—¶
 253   1        IE2 = ET2;    //ä½¿èƒ½å®šæ—¶å™¨ä¸­æ–­
 254   1      }
 255          
 256          //-------------------------å¤–éƒ¨ä¸­æ–­0è¿‡é›¶æ£€æµ‹ä¸­æ–­åˆå§‹åŒ–-------------------------
 257          static void Int0_init(void)
 258          {
 259   1        IT0 = 1;  //è§¦å‘æ–¹å¼ä¸ºä¸‹é™æ²¿è§¦å‘
 260   1        EX0 = 1;  //ä½¿èƒ½INT0ä¸­æ–­
 261   1      }
 262          
 263          
 264          //-------------------------å¤–éƒ¨ä¸­æ–­0æœåŠ¡å‡½æ•°-------------------------
 265          void INT0_ISR() interrupt INT0_VECTOR   //è¿‡é›¶æ£€æµ‹ä¸­æ–­
 266          {
 267   1        //å¯æ§ç¡…æ§åˆ¶æ–¹æ³•ï¼šè¿‡é›¶ç‚¹åå¯æ§ç¡…åœ¨æ²¡æœ‰å¤–éƒ¨è§¦å‘æ¡ä»¶ä¸‹ï¼Œè‡ªåŠ¨å…³é—­.
 268   1        //ç”¨time2ä½œå»¶æ—¶ï¼Œtime2æœ€é•¿å»¶æ—¶é•¿ä¸º10msï¼ŒæŠŠ10msåˆ†æˆ3ä»½ï¼Œå³æ¯ä»½æ—¶é•¿ä¸º3.3ms
 269   1        //ç¬¬ä¸€æ¡£å»¶æ—¶æ—¶é•¿ä¸º10-3.3ms=6.7msï¼Œç¬¬äºŒæ¡£å»¶æ—¶æ—¶é•¿ä¸º10-3.3ms*2=3.4msï¼Œç¬¬ä¸‰æ¡£å…¨æ³¢å½¢å
             -·¥ä½œä¸å»¶æ—¶.è¿‡é›¶ç‚¹æ—¶ç›´æ¥è§¦å‘å¯æ§ç¡…å¯¼é€š
 270   1        //æ‰€ä»¥ä¸€äºŒæ¡£å®šæ—¶å™¨åˆå§‹å€¼è®¡ç®—å¦‚ä¸‹ï¼š
 271   1        //incrementV=(0xffff-0xEC78)/4=0x0662; ---incrementVå˜é‡å€¼ï¼šæŠŠ10msåˆ†æˆ3ä»½æ¯ä¸€ä»½çš„åˆå§‹å€¼çš„
             -å¢é‡å€¼
 272   1        //timeVal=0xEC78 + incrementV * si_level;---preTimeValå˜é‡å€¼ï¼šå³æ˜¯ä¸€äºŒæ¡£å®šæ—¶å™¨åˆå§‹å€¼
 273   1        
 274   1           u16  timeVal;// 0x0662; // 0x04c9; //0x1327;
 275   1           AUXR &= ~0x10;   //å®šæ—¶å™¨2åœæ­¢è®¡æ—¶
 276   1           
 277   1           switch(si_level)
 278   1           {
 279   2             case 0:
 280   2                SI_OFF();  //å…³æ–­å¯æ§ç¡… 
 281   2                return;
 282   2             case 1:
 283   2                 SI_OFF();  //å…³æ–­å¯æ§ç¡… 
 284   2                 //timeVal = 0xEC78 + 0x0662; //å®šæ—¶å™¨åˆå§‹å€¼è¶Šå¤§å»¶æ—¶æ—¶é•¿è¶ŠçŸ­,å®šæ—¶å™¨å·¥ä½œæ–¹å¼æ˜¯å
             -¢é‡æº¢å‡ºäº§ç”Ÿä¸­æ–­.
 285   2                 TH2=242;//timeVal/256;  62170/256;
 286   2                 TL2=218;//timeVal%256;  62170-61952
 287   2              break;
 288   2             case 2:
 289   2                 SI_OFF();  //å…³æ–­å¯æ§ç¡… 
 290   2                 //timeVal = 0xEC78 + 0x0662 *2;
 291   2                 TH2=249;//timeVal/256;   63804/256
 292   2                 TL2=60;//timeVal%256;   63804-63744
 293   2              break;
 294   2             case 3:
 295   2                 SI_ON();   //å¼€å¯å¯æ§ç¡…
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/15/2023 11:00:29 PAGE 6   

 296   2                 return;
 297   2              break;
 298   2           } 
 299   1              
 300   1           AUXR |= 0x10;    //å®šæ—¶å™¨2å¼€å§‹è®¡æ—¶;
 301   1          
 302   1      }
*** WARNING C280 IN LINE 274 OF src\stc8g1k_code.c: 'timeVal': unreferenced local variable
 303          
 304          
 305          
 306          void INT2_ISR() interrupt INT2_VECTOR  //è§¦æ‘¸æŒ‰é”®
 307          {
 308   1        
 309   1      }
 310          u8 display_cnt=0;
 311          void Time0_Handler_Callback(void)   interrupt TIMER0_VECTOR   //139us è¿›ä¸­æ–­æ—¶å·²ç»æ¸…é™¤æ ‡å¿—//ä»»åŠ¡
             -æ ‡è®°å›è°ƒå‡½æ•°
 312          {
 313   1         if(IR_time < 0xfc)
 314   1           IR_time++;
 315   1        
 316   1         Touch_time++;
 317   1      
 318   1         if(display_cnt++ > 40)
 319   1         {
 320   2             display_cnt = 0;
 321   2             led_display();
 322   2         }
 323   1           
 324   1      }
 325          void Time1_Handler_Callback(void) interrupt TIMER1_VECTOR   //125ms è¿›ä¸­æ–­æ—¶å·²ç»æ¸…é™¤æ ‡å¿—//ä»»åŠ¡æ
             - ‡è®°å›è°ƒå‡½æ•°
 326          {
 327   1        static u8 secCount=0;
 328   1      
 329   1        buzzer_timer++;
 330   1        
 331   1        if(++secCount >= 8)
 332   1        {
 333   2           secCount = 0;
 334   2           secFlag=1;
 335   2        }
 336   1        
 337   1        
 338   1        #if 0
                count--;
                if(count == 0)
                {
                   IR_TimeFlag = 1;
                   ET1 = 1;//
                }
                #endif
 346   1        
 347   1      }
 348          
 349          void Time2_Handler_Callback(void) interrupt TIMER2_VECTOR 
 350          {
 351   1          AUXINTIF &= ~T2IF; //æ¸…ä¸­æ–­æ ‡å¿—
 352   1          SI_ON();   //å¼€å¯å¯æ§ç¡…
 353   1          //delay(10);  //å»¶æ—¶2us
 354   1          //SI_OFF();  //å…³æ–­å¯æ§ç¡… 
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/15/2023 11:00:29 PAGE 7   

 355   1          
 356   1      }
 357          
 358          
 359          
 360          
 361          
 362          
 363          
 364          
 365          //-------------------------å®šæ—¶å™¨0åˆå§‹åŒ–----------------------------
 366          #if 0
              static void Time0_init(void)  //139å¾®ç§’@11.0592MHz
              {
                AUXR &= 0x7F; //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼ï¼Œå·¥ä½œæ–¹å¼2
                TMOD &= 0xF0; 
                TMOD |= 0x02; 
                TL0 = 0x80;   
                TH0 = 0x80;   
                TF0 = 0;    //æ¸…é™¤æ ‡å¿—
                ET0 = 1;    //ä½¿èƒ½T0ä¸­æ–­
                TR0 = 1;    //å¯åŠ¨T0
              }
              //-------------------------å®šæ—¶å™¨1åˆå§‹åŒ–---------------------------
              
              static void Time1_init(void)  //278å¾®ç§’@11.0592MHz
              { 
                  AUXR |= 0x40;//æ¨¡å¼2 1T
                  TMOD &= 0x0F; 
              }
              #endif
 386          
 387          
 388          
 389          
 390          
 391          
 392          
 393          
 394          
 395          #if 0
              //-------------------------çº¢å¤–å‘é€é«˜ç”µå¹³----------------------------
              void Wait_High(a)//a*280uS 
              {
                unsigned char k;
                IR_TimeFlag = 0;
                count = a;
                T1_START();
                while(!IR_TimeFlag)  //38khzè½½æ³¢
                {
                  _nop_();
                  _nop_();
                  k = 23;
                  while (--k);
                  IR_IO = ~IR_IO;
                }
                IR_IO = 1;
              }
              //-------------------------çº¢å¤–å‘é€ä½ç”µå¹³----------------------------
              void Wait_Low(a)//a*280uS 
              {
                IR_IO = 1;
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/15/2023 11:00:29 PAGE 8   

                IR_TimeFlag = 0;
                count = a;
                T1_START();
                while(!IR_TimeFlag);
              }
              //-------------------------çº¢å¤–å‘é€å•å­—èŠ‚æ•°æ®----------------------------
              void Send_IR(u8 dat)
              {
                unsigned char i,j;
                Wait_High(2);//0.56ms 
                Wait_Low(4);//1.12ms  
               
                for(j=0;j<8;j++)
                {
                  Wait_High(1);//0.28ms 
                  if(dat&0x01)
                  {
                    Wait_Low(2);// 0.56ms 
                  }
                  else
                  {
                    Wait_Low(1);//0.28ms
                  }
                  dat = dat>>1;    
                }
                
                Wait_High(1);//0.28ms 
              }
              #endif
 446          
 447          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    532    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
