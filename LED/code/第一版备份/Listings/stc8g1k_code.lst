C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/11/2023 20:36:13 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE STC8G1K_CODE
OBJECT MODULE PLACED IN .\Objects\stc8g1k_code.obj
COMPILER INVOKED BY: C:\Keil_C51\C51\BIN\C51.EXE src\stc8g1k_code.c OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\src;.\Driver\
                    -inc;.\Driver\src) DEBUG PRINT(.\Listings\stc8g1k_code.lst) TABS(2) OBJECT(.\Objects\stc8g1k_code.obj)

line level    source

   1          /*******************åŠŸèƒ½æè¿°*******************
   2          è§¦æ‘¸åŠŸèƒ½
   3          
   4          1ã€ç¬¬ä¸€æ¬¡è§¦æ‘¸ç»§ç”µå™¨1 (PCBæ¿æœ€è¾¹ä¸Šè¿™ä¸ªç»§ç”µå™¨)æ¥é€š220Vç”µæºã€‚
   5          
   6          2ã€ç¬¬äºŒæ¬¡è§¦æ‘¸ç»§ç”µå™¨1 (PCBæ¿æœ€è¾¹ä¸Šè¿™ä¸ªç»§ç”µå™¨)æ–­å¼€ï¼Œç»§ç”µå™¨2 (PCBæ¿ä¸­é—´ç»§ç”µå™¨)æ
             -¥é€š220Vç”µæºã€‚
   7          
   8          3ã€ç¬¬ä¸‰æ¬¡è§¦æ‘¸ç»§ç”µå™¨1 ã€æ‘¸ç»§ç”µå™¨2 éƒ½æ¥é€š220Vç”µæºã€‚
   9          
  10          4ã€ç¬¬å››æ¬¡è§¦æ‘¸åˆå›åˆ°ç¬¬ä¸€æ¬¡è§¦æ‘¸å®ç°çš„åŠŸèƒ½ï¼Œåªæœ‰(PCBæ¿æœ€è¾¹ä¸Šè¿™ä¸ªç»§ç”µå™¨)æ¥é€š2
             -20Vç”µæºã€‚
  11          ************************************************/
  12          
  13          #include  "stc8g1k_code.h"    
  14          #include  "STC8xxxx.h"  
  15          #include  "STC8G_H_GPIO.h"
  16          #include  "STC8G_H_ADC.h"
  17          #include  "STC8G_H_NVIC.h"
  18          #include  "string.h"
  19          #include  "global.h"
  20          #include  "led2_digital_tube.h"
  21          #include  "uart.h"
  22          #include  "infrared.h"
  23          #include  "touch.h"
  24          #include "temperature.h"
  25          #include  "buzzer.h"
  26          
  27          #ifdef    UART_ENABLE
              #include  "uart.h"
              #endif
  30          
  31          #define ET2 0x04
  32           
  33          
  34          //æ•°æ®å®šä¹‰
  35          bit timeFunFlag;     //å®šæ—¶åŠŸèƒ½æ ‡å¿—
  36          u8 secFlag=0;       //ç§’æ ‡å¿—
  37          u8 si_level;        //å¯æ§ç¡…æ§åˆ¶çº§æ•° 0å…³é—­ æœ€å¤§3æ¡£
  38          
  39          
  40          //å‡½æ•°å£°æ˜
  41          void delay(u16 count);    //å»¶æ—¶å‡½æ•°å£°æ˜
  42          static void Timer0Init(void);   //å®šæ—¶è®¡æ•°å™¨0åˆå§‹åŒ–å‡½æ•°
  43          static void Timer1Init(void);   //å®šæ—¶è®¡æ•°å™¨1åˆå§‹åŒ–å‡½æ•°
  44          static void Timer2Init(void);   //10æ¯«ç§’@6.000MHz
  45          static void gpio_config(void);
  46          void rdelay_acton_fun(u8 action_value);
  47          static u8  calculate_timer(u16 adValue);
  48          static u8  time_unit_compare(u8 delayTime);
  49          static void ADC_config(void);
  50          static void  timer_deal(void);
  51          static void Int1_init(void);
  52          static void Int0_init(void);
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/11/2023 20:36:13 PAGE 2   

  53          static u8 overtemperature_check(void);
  54          
  55          //-------------------------ä¸»å‡½æ•°----------------------------
  56          void main(void)
  57          {
  58   1        gpio_config();
  59   1        
  60   1        #ifdef  ADC_ENABLE
                //ç”µè·¯æ¿æ¸©åº¦æ£€æµ‹ 
                ADC_config();
                #endif
  64   1        Timer0Init();   //å®šæ—¶è®¡æ•°å™¨0åˆå§‹åŒ–å‡½æ•°
  65   1        Timer1Init();   //å®šæ—¶è®¡æ•°å™¨1åˆå§‹åŒ–å‡½æ•°
  66   1        Timer2Init();   //10æ¯«ç§’@6.000MHz
  67   1        //è¿‡é›¶æ£€æµ‹
  68   1        Int0_init();    //å¤–éƒ¨ä¸­æ–­0åˆå§‹åŒ–å‡½æ•°  è¿‡é›¶æ£€æµ‹è„š
  69   1        //Int3_init();    //å¤–éƒ¨ä¸­æ–­3åˆå§‹åŒ–å‡½æ•°  
  70   1        infrared_init(); //çº¢å¤–åˆå§‹åŒ–å‡½æ•°
  71   1        touch_init();    //è§¦æ‘¸åˆå§‹åŒ–å‡½æ•°
  72   1        buzzer_init();
  73   1        
  74   1        #ifdef UART_ENABLE
                UartInit();
                #endif
  77   1        EA = 1;         //å¼€ä¸­æ–­
  78   1        delay(500);     //ç­‰å¾…é…ç½®ç¨³å®š
  79   1        #ifdef UART_ENABLE
                PrintString1("STC8:\r\n");    //UART1å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²
                #endif
  82   1         
  83   1        rdelay_acton_fun(0);
  84   1        si_level =0;
  85   1        led_display_enable=0;
  86   1        overtemperature_flag=0;
  87   1        buzzerEnableFlag =1;
  88   1        
  89   1        while(1)
  90   1        {    
  91   2           if(overtemperature_check())
  92   2              continue;
  93   2           infrared_check_deal(); 
  94   2           touch_check_deal();//è§¦æ‘¸æ£€æµ‹
  95   2           buzzer_run();
  96   2           
  97   2          #ifdef  ADC_ENABLE  
                    
                  #endif  
 100   2        }
 101   1      }
 102          static u8 overtemperature_check(void)
 103          {
 104   1        if(overtemperature_flag ==1)
 105   1        {
 106   2          overtemperature_flag = 0;
 107   2          rdelay_acton_fun(5);
 108   2          #ifdef UART_ENABLE
                  TX1_write2buff(9);
                  #endif
 111   2          return 1;
 112   2        }
 113   1        return 0;
 114   1      }
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/11/2023 20:36:13 PAGE 3   

 115          
 116          static void gpio_config(void)
 117          {
 118   1        
 119   1         //æ•°ç ç®¡å¼•è„šåˆå§‹åŒ–
 120   1         P3_MODE_OUT_PP(GPIO_Pin_4 |GPIO_Pin_5 |GPIO_Pin_7);   //æ¨æŒ½è¾“å‡ºA B C
 121   1         P1_MODE_OUT_PP(GPIO_Pin_0 |GPIO_Pin_2 |GPIO_Pin_3 |GPIO_Pin_4);   //æ¨æŒ½è¾“å‡ºD E F G 
 122   1         P1_MODE_OUT_PP(GPIO_Pin_5 |GPIO_Pin_6);   //æ¨æŒ½è¾“å‡ºDIG1 DIG2
 123   1         P15 = 0; P16=0;  //æ•°ç ç®¡ä¸æ˜¾ç¤º
 124   1         //è§¦æ‘¸ICå¼•è„šåˆå§‹åŒ– 
 125   1         P5_MODE_OUT_PP(GPIO_Pin_5);   //æ¨æŒ½è¾“å‡ºAH
 126   1         P55 = 1;
 127   1         P3_ST_ENABLE(GPIO_Pin_3);     //æ–½å¯†ç‰¹è§¦å‘ä½¿èƒ½
 128   1         P3_MODE_IN_HIZ(GPIO_Pin_3);   //é«˜é˜»è¾“å…¥ 
 129   1         //Int2_init();  //P3.6/INT2ä¸‹é™æ²¿ä¸­æ–­
 130   1      
 131   1         //å¯æ§ç¡…æ§åˆ¶IOåˆå§‹åŒ–
 132   1         P1_MODE_OUT_PP(GPIO_Pin_7);   //æ¨æŒ½è¾“å‡º 
 133   1         SI_OFF();   //å…³æ–­å¯æ§ç¡…
 134   1         
 135   1         //èœ‚é¸£å™¨IOåˆå§‹åŒ–
 136   1         P1_MODE_OUT_PP(GPIO_Pin_1);   //æ¨æŒ½è¾“å‡º 
 137   1         P11=1;
 138   1        
 139   1      /*
 140   1          #if   0
 141   1        //STC8Gç³»åˆ—å•ç‰‡æœºé™¤P3.0å’ŒP3.1å¤–ï¼Œæ‰€æœ‰I/Oä¸Šç”µå‡ä¸ºé«˜é˜»è¾“å…¥çŠ¶æ€ï¼Œéœ€å…ˆé…ç½®å†ä½¿ç”¨
 142   1        P3M0 |=0x08;    //P3.3å¼•è„šä¸ºæ¨æŒ½è¾“å‡ºæ¨¡å¼
 143   1        P3M1 &=0xF7;    //P3.3å¼•è„šä¸ºæ¨æŒ½è¾“å‡ºæ¨¡å¼
 144   1        RSTCFG &=0xEF;    //å¤ä½å¼•è„šP5.4å½“åšæ™®é€šI/Oå¼•è„š
 145   1        P5M0 |=0x10;    //P5.4å¼•è„šä¸ºæ¨æŒ½è¾“å‡ºæ¨¡å¼
 146   1        P5M1 &=0xEF;    //P5.4å¼•è„šä¸ºæ¨æŒ½è¾“å‡ºæ¨¡å¼
 147   1        P5M0 &=0xDF;    //P5.5å¼•è„šä¸ºå‡†åŒå‘å£æ¨¡å¼
 148   1        P5M1 &=0xDF;    //P5.5å¼•è„šä¸ºå‡†åŒå‘å£æ¨¡å¼
 149   1        #endif
 150   1          GPIO_InitTypeDef  GPIO_InitStructure;   //ç»“æ„å®šä¹‰
 151   1      
 152   1          GPIO_InitStructure.Pin  = GPIO_Pin_0 | GPIO_Pin_1;    //æŒ‡å®šè¦åˆå§‹åŒ–çš„IO, GPIO_Pin_0 ~ GPIO_Pin_7
 153   1          GPIO_InitStructure.Mode = GPIO_PullUp;  //æŒ‡å®šIOçš„è¾“å…¥æˆ–è¾“å‡ºæ–¹å¼,GPIO_PullUp,GPIO_HighZ,GPIO_OU
             -T_OD,GPIO_OUT_PP
 154   1          GPIO_Inilize(GPIO_P3,&GPIO_InitStructure);  //åˆå§‹åŒ–
 155   1        
 156   1         P3_PULL_UP_ENABLE(GPIO_Pin_0 | GPIO_Pin_1);//      
 157   1         //P3_PULL_UP_ENABLE(GPIO_Pin_1);//
 158   1        
 159   1         P1_MODE_OUT_PP(GPIO_Pin_0);   //æ¨æŒ½è¾“å‡ºP1.0 æ§åˆ¶ä¸­é—´ç¬¬äºŒä¸ªç»§ç”µå™¨
 160   1         P3_MODE_OUT_PP(GPIO_Pin_6 |GPIO_Pin_7);   //æ¨æŒ½è¾“å‡ºP3.7 æ§åˆ¶è¾¹ä¸Šç¬¬ä¸€ä¸ªç»§ç”µå™¨  //æ¨æŒ½è¾“
             -å‡ºP3.6 çº¢å¤–ç®¡è§¦æ‘¸IC å°æ¿ç”µæºæ§åˆ¶
 161   1        
 162   1         //P3_MODE_OUT_PP(GPIO_Pin_6);   //æ¨æŒ½è¾“å‡ºP3.6 çº¢å¤–ç®¡è§¦æ‘¸IC å°æ¿ç”µæºæ§åˆ¶
 163   1         P3_MODE_IN_HIZ(GPIO_Pin_3 | GPIO_Pin_4);   //æ–½å¯†ç‰¹è§¦å‘ä½¿èƒ½P3.3 è¿æ¥è§¦æ‘¸ICè¾“å‡ºè„š
 164   1         //P3_MODE_IN_HIZ(GPIO_Pin_4);   //æ–½å¯†ç‰¹è§¦å‘ä½¿èƒ½P3.4 è¿æ¥çº¢å¤–ç®¡æ¥æ”¶è„š
 165   1        
 166   1         DELAY1_OFF;   
 167   1         DELAY2_OFF; 
 168   1         P36 = 0; 
 169   1      */
 170   1      }
 171          //-------------------------å»¶æ—¶å‡½æ•°----------------------------
 172          void delay(u16 count)
 173          {
 174   1        while(count--)
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/11/2023 20:36:13 PAGE 4   

 175   1        {
 176   2          _nop_();
 177   2        }
 178   1      }
 179          
 180          void rdelay_acton_fun(u8 action_value)
 181          {
 182   1          switch(action_value)
 183   1          {
 184   2              case 0:  // æ–­å¼€æ‰€æœ‰ç»§ç”µå™¨
 185   2                led_display_enable=0;  //ä¸Šç”µLEDæ•°ç ç®¡ä¸æ˜¾ç¤º
 186   2                si_level = 0; 
 187   2              break;
 188   2              case 1:   //æ•°ç ç®¡æ˜¾ç¤º--
 189   2                  led_display_enable=1; 
 190   2                  digital_value[0]=0xff;
 191   2                  digital_value[1]=0xff;
 192   2                  buzzerEnableFlag = 1;
 193   2                  si_level = 0;
 194   2              break;
 195   2              case 2:  //æ•°ç ç®¡æ˜¾ç¤ºL1
 196   2                  led_display_enable=1; 
 197   2                  digital_value[0]=0x10;
 198   2                  digital_value[1]=0x01;
 199   2                  //buzzerEnableFlag = 1;
 200   2                  si_level = 1;
 201   2              break;
 202   2              case 3:
 203   2                  led_display_enable=1; 
 204   2                  digital_value[0]=0x10;
 205   2                  digital_value[1]=0x02;
 206   2                  //buzzer_enable = 1;
 207   2                  si_level = 2;
 208   2              break;
 209   2              case 4:
 210   2                  led_display_enable=1; 
 211   2                  digital_value[0]=0x10;
 212   2                  digital_value[1]=0x03;
 213   2                  //buzzer_enable = 1;
 214   2                  si_level = 3;
 215   2              break;
 216   2              case 5:
 217   2                  led_display_enable=1; 
 218   2                  digital_value[0]=0x0e;
 219   2                  digital_value[1]=0x01;
 220   2                  //buzzer_enable = 0;
 221   2                  si_level = 0;
 222   2              break;
 223   2              default:
 224   2                
 225   2              break;
 226   2          }
 227   1      }
 228          
 229          //-------------------------å®šæ—¶å™¨åˆå§‹åŒ–----------------------------
 230          static void Timer0Init(void)    //139å¾®ç§’@6.000MHz
 231          {
 232   1        AUXR &= 0x7F;   //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
 233   1        TMOD &= 0xF0;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 234   1        TMOD |= 0x02;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 235   1        TL0 = 0xBA;   //è®¾ç½®å®šæ—¶åˆå€¼
 236   1        TH0 = 0xBA;   //è®¾ç½®å®šæ—¶é‡è½½å€¼
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/11/2023 20:36:13 PAGE 5   

 237   1        TF0 = 0;    //æ¸…é™¤TF0æ ‡å¿—
 238   1        TR0 = 1;    //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
 239   1        ET0 = 1;    //ä½¿èƒ½T0ä¸­æ–­
 240   1      }
 241          static void Timer1Init(void)    //125æ¯«ç§’@6.000MHz
 242          {
 243   1        AUXR &= 0xBF;   //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
 244   1        TMOD &= 0x0F;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 245   1        TL1 = 0xDC;   //è®¾ç½®å®šæ—¶åˆå€¼
 246   1        TH1 = 0x0B;   //è®¾ç½®å®šæ—¶åˆå€¼
 247   1        TF1 = 0;    //æ¸…é™¤TF1æ ‡å¿—
 248   1        TR1 = 1;    //å®šæ—¶å™¨1å¼€å§‹è®¡æ—¶
 249   1        
 250   1        ET1 = 1;    //ä½¿èƒ½T1ä¸­æ–­
 251   1      }
 252          static void Timer2Init(void)    //10æ¯«ç§’@6.000MHz
 253          {
 254   1        AUXINTIF &= ~T2IF; //æ¸…ä¸­æ–­æ ‡å¿—
 255   1        AUXR &= 0xFB;   //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
 256   1        T2L = 0x78;   //è®¾ç½®å®šæ—¶åˆå€¼
 257   1        T2H = 0xEC;   //è®¾ç½®å®šæ—¶åˆå€¼
 258   1        AUXR &= ~0x10;//å®šæ—¶å™¨2ä¸è®¡æ—¶
 259   1        IE2 = ET2;    //ä½¿èƒ½å®šæ—¶å™¨ä¸­æ–­
 260   1      }
 261          
 262          //-------------------------å¤–éƒ¨ä¸­æ–­0è¿‡é›¶æ£€æµ‹ä¸­æ–­åˆå§‹åŒ–-------------------------
 263          static void Int0_init(void)
 264          {
 265   1        IT0 = 1;  //è§¦å‘æ–¹å¼ä¸ºä¸‹é™æ²¿è§¦å‘
 266   1        EX0 = 1;  //ä½¿èƒ½INT0ä¸­æ–­
 267   1      }
 268          
 269          
 270          //-------------------------å¤–éƒ¨ä¸­æ–­0æœåŠ¡å‡½æ•°-------------------------
 271          void INT0_ISR() interrupt INT0_VECTOR   //è¿‡é›¶æ£€æµ‹ä¸­æ–­
 272          {
 273   1        //å¯æ§ç¡…æ§åˆ¶æ–¹æ³•ï¼šè¿‡é›¶ç‚¹åå¯æ§ç¡…åœ¨æ²¡æœ‰å¤–éƒ¨è§¦å‘æ¡ä»¶ä¸‹ï¼Œè‡ªåŠ¨å…³é—­.
 274   1        //ç”¨time2ä½œå»¶æ—¶ï¼Œtime2æœ€é•¿å»¶æ—¶é•¿ä¸º10msï¼ŒæŠŠ10msåˆ†æˆ3ä»½ï¼Œå³æ¯ä»½æ—¶é•¿ä¸º3.3ms
 275   1        //ç¬¬ä¸€æ¡£å»¶æ—¶æ—¶é•¿ä¸º10-3.3ms=6.7msï¼Œç¬¬äºŒæ¡£å»¶æ—¶æ—¶é•¿ä¸º10-3.3ms*2=3.4msï¼Œç¬¬ä¸‰æ¡£å…¨æ³¢å½¢å
             -·¥ä½œä¸å»¶æ—¶.è¿‡é›¶ç‚¹æ—¶ç›´æ¥è§¦å‘å¯æ§ç¡…å¯¼é€š
 276   1        //æ‰€ä»¥ä¸€äºŒæ¡£å®šæ—¶å™¨åˆå§‹å€¼è®¡ç®—å¦‚ä¸‹ï¼š
 277   1        //incrementV=(0xffff-0xEC78)/4=0x0662; ---incrementVå˜é‡å€¼ï¼šæŠŠ10msåˆ†æˆ3ä»½æ¯ä¸€ä»½çš„åˆå§‹å€¼çš„
             -å¢é‡å€¼
 278   1        //timeVal=0xEC78 + incrementV * si_level;---preTimeValå˜é‡å€¼ï¼šå³æ˜¯ä¸€äºŒæ¡£å®šæ—¶å™¨åˆå§‹å€¼
 279   1        
 280   1           u16  timeVal;// 0x0662; // 0x04c9; //0x1327;
 281   1           AUXR &= ~0x10;   //å®šæ—¶å™¨2åœæ­¢è®¡æ—¶
 282   1      
 283   1           switch(si_level)
 284   1           {
 285   2             case 0:
 286   2                SI_OFF();  //å…³æ–­å¯æ§ç¡… 
 287   2                return;
 288   2             case 1:
 289   2                 timeVal = 0xEC78 + 0x0662; //å®šæ—¶å™¨åˆå§‹å€¼è¶Šå¤§å»¶æ—¶æ—¶é•¿è¶ŠçŸ­,å®šæ—¶å™¨å·¥ä½œæ–¹å¼æ˜¯å¢
             -é‡æº¢å‡ºäº§ç”Ÿä¸­æ–­.
 290   2                 TH2=timeVal/256;
 291   2                 TL2=timeVal%256;
 292   2              break;
 293   2             case 2:
 294   2                 timeVal = 0xEC78 + 0x0662 *2;
 295   2                 TH2=timeVal/256;
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/11/2023 20:36:13 PAGE 6   

 296   2                 TL2=timeVal%256;
 297   2              break;
 298   2             case 3:
 299   2                 SI_ON();   //å¼€å¯å¯æ§ç¡…
 300   2                 return;
 301   2              break;
 302   2           } 
 303   1              
 304   1           AUXR |= 0x10;    //å®šæ—¶å™¨2å¼€å§‹è®¡æ—¶;
 305   1          
 306   1      }
 307          
 308          
 309          
 310          void INT2_ISR() interrupt INT2_VECTOR  //è§¦æ‘¸æŒ‰é”®
 311          {
 312   1        
 313   1      }
 314          u8 display_cnt=0;
 315          void Time0_Handler_Callback(void)   interrupt TIMER0_VECTOR   //139us è¿›ä¸­æ–­æ—¶å·²ç»æ¸…é™¤æ ‡å¿—//ä»»åŠ¡
             -æ ‡è®°å›è°ƒå‡½æ•°
 316          {
 317   1         if(IR_time < 0xfc)
 318   1           IR_time++;
 319   1        
 320   1         Touch_time++;
 321   1      
 322   1         if(display_cnt++ > 40)
 323   1         {
 324   2             display_cnt = 0;
 325   2             led_display();
 326   2         }
 327   1           
 328   1      }
 329          void Time1_Handler_Callback(void) interrupt TIMER1_VECTOR   //125ms è¿›ä¸­æ–­æ—¶å·²ç»æ¸…é™¤æ ‡å¿—//ä»»åŠ¡æ
             - ‡è®°å›è°ƒå‡½æ•°
 330          {
 331   1        static u8 secCount=0;
 332   1      
 333   1        buzzer_timer++;
 334   1        
 335   1        if(++secCount >= 8)
 336   1        {
 337   2           secCount = 0;
 338   2           secFlag=1;
 339   2           if(timeFunFlag)   //å®šæ—¶åŠŸèƒ½å¼€å¯æ‰è®¡æ•°
 340   2               time_cnt++;   //8å°æ—¶å®šæ—¶è®¡æ•°å™¨ 1sç´¯åŠ ä¸€æ¬¡ 
 341   2        }
 342   1        
 343   1        
 344   1        #if 0
                count--;
                if(count == 0)
                {
                   IR_TimeFlag = 1;
                   ET1 = 1;//
                }
                #endif
 352   1        
 353   1      }
 354          
 355          void Time2_Handler_Callback(void) interrupt TIMER2_VECTOR 
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/11/2023 20:36:13 PAGE 7   

 356          {
 357   1          AUXINTIF &= ~T2IF; //æ¸…ä¸­æ–­æ ‡å¿—
 358   1          SI_ON();   //å¼€å¯å¯æ§ç¡…
 359   1          delay(10);  //å»¶æ—¶2us
 360   1          SI_OFF();  //å…³æ–­å¯æ§ç¡… 
 361   1          
 362   1      }
 363          
 364          
 365          
 366          //-------------------------å®šæ—¶å™¨0åˆå§‹åŒ–----------------------------
 367          #if 0
              static void Time0_init(void)  //139å¾®ç§’@11.0592MHz
              {
                AUXR &= 0x7F; //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼ï¼Œå·¥ä½œæ–¹å¼2
                TMOD &= 0xF0; 
                TMOD |= 0x02; 
                TL0 = 0x80;   
                TH0 = 0x80;   
                TF0 = 0;    //æ¸…é™¤æ ‡å¿—
                ET0 = 1;    //ä½¿èƒ½T0ä¸­æ–­
                TR0 = 1;    //å¯åŠ¨T0
              }
              //-------------------------å®šæ—¶å™¨1åˆå§‹åŒ–---------------------------
              
              static void Time1_init(void)  //278å¾®ç§’@11.0592MHz
              { 
                  AUXR |= 0x40;//æ¨¡å¼2 1T
                  TMOD &= 0x0F; 
              }
              #endif
 387          
 388          
 389          
 390          
 391          
 392          
 393          
 394          
 395          
 396          #if 0
              //-------------------------çº¢å¤–å‘é€é«˜ç”µå¹³----------------------------
              void Wait_High(a)//a*280uS 
              {
                unsigned char k;
                IR_TimeFlag = 0;
                count = a;
                T1_START();
                while(!IR_TimeFlag)  //38khzè½½æ³¢
                {
                  _nop_();
                  _nop_();
                  k = 23;
                  while (--k);
                  IR_IO = ~IR_IO;
                }
                IR_IO = 1;
              }
              //-------------------------çº¢å¤–å‘é€ä½ç”µå¹³----------------------------
              void Wait_Low(a)//a*280uS 
              {
                IR_IO = 1;
C51 COMPILER V9.59.0.0   STC8G1K_CODE                                                      02/11/2023 20:36:13 PAGE 8   

                IR_TimeFlag = 0;
                count = a;
                T1_START();
                while(!IR_TimeFlag);
              }
              //-------------------------çº¢å¤–å‘é€å•å­—èŠ‚æ•°æ®----------------------------
              void Send_IR(u8 dat)
              {
                unsigned char i,j;
                Wait_High(2);//0.56ms 
                Wait_Low(4);//1.12ms  
               
                for(j=0;j<8;j++)
                {
                  Wait_High(1);//0.28ms 
                  if(dat&0x01)
                  {
                    Wait_Low(2);// 0.56ms 
                  }
                  else
                  {
                    Wait_Low(1);//0.28ms
                  }
                  dat = dat>>1;    
                }
                
                Wait_High(1);//0.28ms 
              }
              #endif
 447          
 448          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    588    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
