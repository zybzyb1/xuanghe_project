C51 COMPILER V9.59.0.0   TEMPERATURE                                                       02/11/2023 16:58:35 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE TEMPERATURE
OBJECT MODULE PLACED IN .\Objects\temperature.obj
COMPILER INVOKED BY: C:\Keil_C51\C51\BIN\C51.EXE src\temperature.c OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\src;.\Driver\i
                    -nc;.\Driver\src) DEBUG PRINT(.\Listings\temperature.lst) TABS(2) OBJECT(.\Objects\temperature.obj)

line level    source

   1          #include "temperature.h"
   2          
   3          bit overtemperature_flag;
   4          
   5          
   6          #ifdef  ADC_ENABLE  
              void temperature_init(void)
              {
                  overtemperature_flag = 0;
                        
                  
              }
              //------------------------------------------------
              void  temperature_get_deal(void)
              {
                  u16  ad_dat;
                  static u16  ad_pre=0xffff;
                  static u8  delay_time=0;
                
                  if(secFlag==1)  //1Ãë ADCÒ»´Î
                  {
                      secFlag = 0;
                      ad_dat = Get_ADCResult(ADC_CH13);  //¶ÁÈ¡ADC¶¨Ê±Öµ
                    
                      if(ad_dat == 4096)  return;   //³ö´í
                      
                      if(ad_dat > 1024 / TIMER_LENGTH_MAX / 2)//¶¨Ê±¹¦ÄÜ¿ªÆô
                      {     
                          if(ad_pre > ad_dat+15 || ad_pre < ad_dat-15)
                          {
                              ad_pre = ad_dat;
                              timeFunFlag = 1;  //¶¨Ê±¹¦ÄÜ¿ªÆô
                              time_cnt = 0;   //¶¨Ê±¼ÆÊýÆ÷ÇåÁã
                              delay_time = calculate_timer(ad_dat); //¼ÆËã³ö¶¨Ê±Ê±³¤
                          }
                      }
                      else
                          timeFunFlag = 0;   //¶¨Ê±¹¦ÄÜ¹Ø±Õ
                      
                      if(timeFunFlag)
                      { 
                          if(time_unit_compare(delay_time))  
                          {                     //¶¨Ê±Ê±¼äµ½ÁË
                              btn_value=0;
                              rdelay_acton_fun(0);
                              timeFunFlag = 0;  //¶¨Ê±¹¦ÄÜ¹Ø±Õ
                              sysFunFlag = 0;
                          } 
                      }       
                  }   
              }
              static u8  time_unit_compare(u8 delayTime)
              {
                  u32 delay_T;
C51 COMPILER V9.59.0.0   TEMPERATURE                                                       02/11/2023 16:58:35 PAGE 2   

                
                  delay_T = delayTime*30*60;   //delayTimeµ¥Î»Îª°ë¸öÐ¡Ê± ÕâÀï×ª»¯ÎªÃë
                   
                  if(time_cnt > delay_T)
                  {
                      time_cnt = 0; //¶¨Ê±¼ÆÊýÇåÁã
                      return 1;
                  }
                  return 0;
              }
              static u8  calculate_timer(u16 adValue)
              { 
                u8  timing_time=0;  //¶¨Ê±Ê±³¤ µ¥Î»1±íÐ¡0.5Ð¡Ê±
                u16 step_length = 1024 / TIMER_LENGTH_MAX; //ÕâÀï¼ÆËã¶¨Ê±²½³¤¶ÔÓ¦µÄÊýÖµ,µ±ADCÖµÊÇµÍ°ë²½¹Ø±Õ¶¨Ê±¹¦ÄÜ,×î¸ß°
             -ë²½ÖµÊ±¶¨Ê±Ê±³¤8¸öÐ¡Ê±
                u16  half_length =  step_length/2;
                if(adValue < half_length)   //ADCÊýÖµÐ¡ÓÚ32¹Ø±Õ¶¨Ê±
                     timing_time = 0;
                else if(adValue > 1024- half_length) //ADCÊýÖµ´óÓÚ1024-32=992¶¨Ê±8Ð¡Ê±
                     timing_time = 16; //8 Ð¡Ê±
                else
                  {    // ¼ÆËã¶¨Ê±Ê±³¤²½³¤Îª0.5Ð¡Ê±  Ã¿Ò»²½³¤¶ÔÓ¦ADCÊýÖµ64
                    timing_time = adValue/step_length; 
                    //ADCÊýÖµ<=32 ¹Êtiming_time=0 ¶¨Ê±³¤Îª0Ð¡Ê±£¬
                    //32<ADCÊýÖµ<=96 ¹Êtiming_time=1 ¶¨Ê±³¤Îª°ëÐ¡Ê±£¬96<ADCÊýÖµ<160 ¹Êtiming_time=2 ¶¨Ê±³¤Îª1Ð¡Ê± .160<ADCÊ
             -ýÖµ<224 ¹Êtiming_time=3 ¶¨Ê±³¤Îª1.5Ð¡Ê± 
                    //224<ADCÊýÖµ<=288 ¹Êtiming_time=4 ¶¨Ê±³¤Îª2Ð¡Ê±,288<ADCÊýÖµ<352 ¹Êtiming_time=5 ¶¨Ê±³¤Îª2.5Ð¡Ê±,352<AD
             -CÊýÖµ<416 ¹Êtiming_time=6 ¶¨Ê±³¤Îª3Ð¡Ê± 
                    //416<ADCÊýÖµ<=480 ¹Êtiming_time=7 ¶¨Ê±³¤Îª3.5Ð¡Ê±480<ADCÊýÖµ<544 ¹Êtiming_time=8 ¶¨Ê±³¤Îª4Ð¡Ê± 544<ADC
             -ÊýÖµ<608 ¹Êtiming_time=9 ¶¨Ê±³¤Îª4.5Ð¡Ê± 
                    //608<ADCÊýÖµ<=672 ¹Êtiming_time=10 ¶¨Ê±³¤Îª5Ð¡Ê±,672<ADCÊýÖµ<736 ¹Êtiming_time=11 ¶¨Ê±³¤Îª5.5Ð¡Ê±,736<
             -ADCÊýÖµ<800 ¹Êtiming_time=12 ¶¨Ê±³¤Îª6Ð¡Ê±
                    //800<ADCÊýÖµ<=864 ¹Êtiming_time=13 ¶¨Ê±³¤Îª6.5Ð¡Ê±£¬864<ADCÊýÖµ<928 ¹Êtiming_time=14 ¶¨Ê±³¤Îª7Ð¡Ê±9
             -28<ADCÊýÖµ<992 ¹Êtiming_time=15 ¶¨Ê±³¤Îª7.5Ð¡Ê± 
                    //992<ADCÊýÖµ<=1024 ¹Êtiming_time=16 ¶¨Ê±³¤Îª8Ð¡Ê±.     
                    if(adValue % step_length  > half_length)
                         timing_time++;
                
                }
                  return timing_time;
              }
              //========================================================================
              static void ADC_config(void)
              {
                
                ADC_InitTypeDef   ADC_InitStructure;    //½á¹¹¶¨Òå
                ADC_InitStructure.ADC_SMPduty   = 31;   //ADC Ä£ÄâÐÅºÅ²ÉÑùÊ±¼ä¿ØÖÆ, 0~31£¨×¢Òâ£º SMPDUTY Ò»¶¨²»ÄÜÉèÖÃÐ¡ÓÚ 
             -10£©
                ADC_InitStructure.ADC_CsSetup   = 0;    //ADC Í¨µÀÑ¡ÔñÊ±¼ä¿ØÖÆ 0(Ä¬ÈÏ),1
                ADC_InitStructure.ADC_CsHold    = 1;    //ADC Í¨µÀÑ¡Ôñ±£³ÖÊ±¼ä¿ØÖÆ 0,1(Ä¬ÈÏ),2,3
                ADC_InitStructure.ADC_Speed     = ADC_SPEED_2X1T;   //ÉèÖÃ ADC ¹¤×÷Ê±ÖÓÆµÂÊ ADC_SPEED_2X1T~ADC_SPEED_2X16T
                ADC_InitStructure.ADC_AdjResult = ADC_RIGHT_JUSTIFIED;  //ADC½á¹ûµ÷Õû,  ADC_LEFT_JUSTIFIED,ADC_RIGHT_JUSTIF
             -IED
                ADC_Inilize(&ADC_InitStructure);    //³õÊ¼»¯
                ADC_PowerControl(ENABLE);           //ADCµçÔ´¿ª¹Ø, ENABLE»òDISABLE
                //NVIC_ADC_Init(DISABLE,Polity_0);    //ÖÐ¶ÏÊ¹ÄÜ, ENABLE/DISABLE; ÓÅÏÈ¼¶(µÍµ½¸ß) Polity_0,Polity_1,Polity_2
             -,Polity_3
                
              }
              #endif  


C51 COMPILER V9.59.0.0   TEMPERATURE                                                       02/11/2023 16:58:35 PAGE 3   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   ----    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
